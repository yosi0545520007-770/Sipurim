import{b as z,d as B,r as a,s as L,j as e}from"./index-Ri0qBRCu.js";function F(){const r=z(),{isHeard:S}=B(),[n,j]=a.useState([]),[c,x]=a.useState(0),[m,f]=a.useState(!0),[b,w]=a.useState(null),[M,u]=a.useState(!1),[g,p]=a.useState(!1);a.useEffect(()=>{(async()=>{try{f(!0),w(null);const{data:s,error:l}=await L.from("stories").select("id,title,audio_url,image_url").is("series_id",null).not("audio_url","is",null).neq("audio_url","");if(l)throw l;const i=(s||[]).filter(_=>!S(_.id)),d=i.length>0?i:s||[];j(k(d)),x(0)}catch(s){w(s.message||"שגיאה בטעינת סיפורים")}finally{f(!1)}})()},[]);const y=`יְהִי רָצוֹן מִלְּפָנֶיךָ ה' אֱלֹהֵינוּ וֵאלֹהֵי אֲבוֹתֵינוּ, שֶׁתּוֹלִיכֵנוּ לְשָׁלוֹם וְתַצְעִידֵנוּ לְשָׁלוֹם. וְתִסְמְכֵנוּ לְשָׁלוֹם. וְתַדְרִיכֵנוּ בְּדֶרֶךְ יְשָׁרָה. וְתַגִּיעֵנוּ לִמְחוֹז חֶפְצֵנוּ לְחַיִּים וּלְשִׂמְחָה וּלְשָׁלוֹם, וְתַחְזִירֵנוּ לְשָׁלוֹם. וְתַצִּילֵנוּ מִכַּף כָּל אוֹיֵב וְאוֹרֵב וְלִסְטִים וְחַיּוֹת רָעוֹת בַּדֶּרֶךְ, וּמִכָּל מִינֵי פֻּרְעָנֻיּוֹת הַמִּתְרַגְּשׁוֹת לָבוֹא לָעוֹלָם. וְתִשְׁלַח בְּרָכָה בְּכָל מַעֲשֵׂה יָדֵינוּ, וְתִתְּנֵנוּ לְחֵן וּלְחֶסֶד וּלְרַחֲמִים בְּעֵינֶיךָ וּבְעֵינֵי כָל רוֹאֵינוּ. וְתִגְמְלֵנוּ חֲסָדִים טוֹבִים, וְתִשְׁמַע קוֹל תְּפִלָּתֵנוּ, כִּי אַתָּה שׁוֹמֵעַ תְּפִלַּת כָּל פֶּה. בָּרוּךְ אַתָּה ה', שׁוֹמֵעַ תְּפִלָּה:
וְיַעֲקֹב הָלַךְ לְדַרְכּוֹ וַיִּפְגְּעוּ בוֹ מַלְאֲכֵי אֱלֹהִים: לִקְרַאתְכֶם יֵצְאוּ. יְבָרֶכְךָ ה' וְיִשְׁמְרֶךָ: יָאֵר ה' פָּנָיו אֵלֶיךָ וִיחֻנֶּךָּ: יִשָּׂא ה' פָּנָיו אֵלֶיךָ וְיָשֵׂם לְךָ שָׁלוֹם:`;function P(){if(!(typeof window>"u"||!("speechSynthesis"in window)))if(g)window.speechSynthesis.cancel(),p(!1);else{const l=window.speechSynthesis.getVoices().find(d=>d.lang==="he-IL"&&d.name.includes("Google")),i=new SpeechSynthesisUtterance(y);i.lang="he-IL",i.rate=.9,i.onend=()=>p(!1),l&&(i.voice=l),window.speechSynthesis.speak(i),p(!0)}}a.useEffect(()=>()=>{var s;return(s=window.speechSynthesis)==null?void 0:s.cancel()},[]);const t=n.length>0?n[c]:null;function o(s){x(s),n.length>0&&n[s]&&r.playQueue(n,s)}function v(){n.length&&o((c+1)%n.length)}function N(){n.length&&o((c-1+n.length)%n.length)}function C(){j(k(n)),x(0),r.pause()}const h=r.playing;function k(s){const l=s.slice();for(let i=l.length-1;i>0;i--){const d=Math.floor(Math.random()*(i+1));[l[i],l[d]]=[l[d],l[i]]}return l}return e.jsxs("section",{className:"p-6 max-w-6xl mx-auto",dir:"rtl",children:[e.jsx("button",{onClick:()=>u(!0),className:"fixed bottom-24 md:bottom-6 left-6 z-40 bg-blue-600 text-white rounded-full shadow-lg px-4 py-2 text-sm hover:bg-blue-700",children:"תפילת הדרך"}),M&&e.jsx("div",{className:"fixed inset-0 bg-black/40 z-50 grid place-items-center p-4",onClick:()=>{u(!1),window.speechSynthesis.cancel()},children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-md w-full",onClick:s=>s.stopPropagation(),children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-center",children:'תפילת הדרך (נוסח חב"ד)'}),e.jsx("div",{className:"space-y-4 text-center leading-loose",children:y.split(`
`).map((s,l)=>e.jsx("p",{className:l>0?"font-semibold":"",children:s},l))}),e.jsxs("div",{className:"text-center mt-6 flex items-center justify-center gap-4",children:["speechSynthesis"in window&&e.jsxs("button",{onClick:P,className:"bg-gray-200 text-gray-800 px-4 py-2 rounded-lg flex items-center gap-2",children:[g?e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{width:"4",height:"16",x:"6",y:"4"}),e.jsx("rect",{width:"4",height:"16",x:"14",y:"4"})]}):e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}),e.jsx("path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07"})]}),g?"עצור":"הקרא"]}),e.jsx("button",{onClick:()=>{u(!1),window.speechSynthesis.cancel()},className:"bg-blue-600 text-white px-4 py-2 rounded-lg",children:"סגירה"})]})]})}),e.jsx("h1",{className:"text-2xl font-bold mb-3",children:"סיפורים ברצף לנסיעה"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"רשימת השמעה אקראית מכל הסיפורים עם שמע. אפשר לדלג קדימה/אחורה ולערבב מחדש."}),b&&e.jsx("div",{className:"bg-red-50 text-red-700 p-3 rounded mb-3",children:b}),m&&e.jsx("div",{className:"text-gray-600",children:"טוען..."}),!m&&n.length===0&&e.jsx("div",{className:"text-gray-600",children:"לא נמצאו סיפורים עם קובץ שמע."}),!m&&n.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6 lg:gap-8 items-start bg-white border rounded-2xl overflow-hidden shadow-sm p-4 mb-10",children:[e.jsxs("div",{className:"space-y-3 relative",children:[t!=null&&t.image_url?e.jsx("img",{src:t.image_url,alt:t.title,className:"w-full rounded-lg object-cover"}):e.jsx("div",{className:"w-full h-48 bg-gray-100 grid place-items-center text-gray-400",children:"אין תמונה"}),(t==null?void 0:t.audio_url)&&(()=>{var l;return((l=r.current)==null?void 0:l.id)===t.id&&r.playing?null:e.jsxs("button",{className:"absolute inset-0 flex flex-col items-center justify-center gap-2 bg-black/30",onClick:()=>o(c),"aria-label":"נגן סיפור",title:"נגן",children:[e.jsx("span",{className:"w-14 h-14 rounded-full bg-gray-800/60 text-white backdrop-blur flex items-center justify-center",children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-7 h-7","aria-hidden":"true",children:e.jsx("path",{d:"M8 5v14l11-7z"})})}),e.jsx("span",{className:"text-white font-semibold bg-black/30 px-2 py-1 rounded",children:"לחצו להאזנה לסיפור"})]})})()]}),e.jsxs("div",{className:"flex flex-col justify-center",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:(t==null?void 0:t.title)||""}),e.jsx("p",{className:"text-gray-700 leading-relaxed",children:"הפעלה אקראית של סיפורים שטרם הושמעו. אם כל הסיפורים כבר הושמעו, הרשימה תתערבב מחדש."}),e.jsx("div",{className:"mt-4 flex items-center gap-3 flex-wrap"})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-[1fr_320px] hidden",children:[e.jsxs("div",{className:"rounded-2xl border bg-white p-4 order-2 md:order-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("button",{onClick:N,className:"px-3 py-2 rounded border",children:"הקודם"}),e.jsxs("button",{onClick:()=>{!r.current&&n.length?o(c):r.toggle()},className:"px-4 py-2 rounded bg-blue-600 text-white","aria-label":"נגן",children:[h?e.jsxs(e.Fragment,{children:[e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-5 h-5 inline","aria-hidden":"true",children:e.jsx("path",{d:"M6 5h4v14H6zM14 5h4v14h-4z"})}),e.jsx("span",{className:"sr-only",children:"השהה"})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-5 h-5 inline","aria-hidden":"true",children:e.jsx("path",{d:"M8 5v14l11-7z"})}),e.jsx("span",{className:"sr-only",children:"נגן"})]}),h?"השהה":"נגן"]}),e.jsx("button",{onClick:v,className:"px-3 py-2 rounded border",children:"הבא"}),e.jsx("button",{onClick:C,className:"px-3 py-2 rounded border ml-auto",children:"ערבב מחדש"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3 hidden",children:[e.jsx("button",{onClick:N,className:"px-3 py-2 rounded border",children:"‹ הקודם"}),e.jsxs("button",{onClick:()=>r.toggle(),className:"px-4 py-2 rounded bg-blue-600 text-white","aria-label":"נגן",children:[h?e.jsxs(e.Fragment,{children:[e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-5 h-5 inline","aria-hidden":"true",children:e.jsx("path",{d:"M6 5h4v14H6zM14 5h4v14h-4z"})}),e.jsx("span",{className:"sr-only",children:"השהה"})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-5 h-5 inline","aria-hidden":"true",children:e.jsx("path",{d:"M8 5v14l11-7z"})}),e.jsx("span",{className:"sr-only",children:"נגן"})]}),h?"הפסק":"נגן"]}),e.jsx("button",{onClick:v,className:"px-3 py-2 rounded border",children:"הבא ›"}),e.jsx("button",{onClick:C,className:"px-3 py-2 rounded border ml-auto",children:"ערבב מחדש"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"מנגן כעת:"}),e.jsx("div",{className:"font-medium",children:(t==null?void 0:t.title)||"—"})]}),t&&e.jsx("div",{className:"text-sm text-gray-600",children:"מנגן דרך המיני-נגן הגלובלי"})]}),e.jsx("div",{className:"rounded-2xl border bg-white divide-y order-1 md:order-2 max-h-[70vh] overflow-y-auto",children:n.map((s,l)=>e.jsxs("button",{onClick:()=>o(l),className:`w-full text-right p-3 flex items-center gap-3 hover:bg-gray-50 ${l===c?"bg-blue-50":""}`,children:[e.jsx("span",{className:"text-xs text-gray-500 w-8 shrink-0",children:l+1}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm",children:s.title}),e.jsx("div",{className:"text-xs text-gray-500 truncate",children:s.audio_url})]})]},s.id))})]})]}),h&&e.jsx("div",{className:"h-20 md:hidden"})]})}export{F as Component};
