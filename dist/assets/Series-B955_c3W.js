import{u as j,r as l,s as n,j as e}from"./index-DhAAA4kQ.js";function b(){const a=j(),[o,p]=l.useState([]),[i,c]=l.useState(null),[d,u]=l.useState(!0),[m,h]=l.useState(null),[x,f]=l.useState("");l.useEffect(()=>{(async()=>{u(!0),c(null);const{data:s,error:t}=await n.from("series").select("id,title,description,cover_url,created_at").order("created_at",{ascending:!1}).limit(50);t&&c(t.message),p(s||[]);const{data:r}=await n.from("settings").select("value").eq("key","site_logo_url").maybeSingle();f((r==null?void 0:r.value)||"/logo.png"),u(!1)})()},[]);async function y(s){h(s);try{const{data:t,error:r}=await n.from("stories").select("id, title, audio_url, series_id").eq("series_id",s).not("audio_url","is",null).order("series_order",{ascending:!0}).order("publish_at",{ascending:!0});if(r)throw r;const g=t||[];g.length>0?a.playQueue(g,0):alert("לא נמצאו פרקים עם שמע לסדרה זו.")}catch(t){c(t.message||"שגיאה בטעינת פרקי הסדרה")}finally{h(null)}}return e.jsxs("section",{className:"container mx-auto px-4 py-10",dir:"rtl",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"סיפורים בהמשכים"}),d&&e.jsx("div",{className:"text-gray-500",children:"טוען…"}),i&&e.jsx("div",{className:"rounded-lg bg-red-50 text-red-700 p-3 mb-4",children:i}),e.jsx("div",{className:"grid md:grid-cols-3 gap-6",children:o.map(s=>(a.queue.some(t=>t.id.startsWith(s.id))&&a.playing,e.jsxs("article",{className:"group relative rounded-2xl border bg-white overflow-hidden shadow-sm transition-shadow hover:shadow-md",children:[e.jsxs("div",{className:"relative w-full aspect-[16/9] overflow-hidden bg-gray-100",children:[s.cover_url||x?e.jsx("img",{src:s.cover_url||x,alt:s.title,className:`w-full h-full ${s.cover_url?"object-cover":"object-contain p-4"}`,loading:"lazy"}):e.jsx("div",{className:"w-full h-full grid place-items-center text-xs text-gray-400",children:"ללא תמונה"}),e.jsx("div",{className:"absolute inset-0 bg-black/20 flex items-center justify-center",children:e.jsx("button",{onClick:()=>y(s.id),className:"w-14 h-14 rounded-full bg-gray-800/60 text-white backdrop-blur flex items-center justify-center disabled:opacity-50 disabled:cursor-wait","aria-label":`נגן את סדרת ${s.title}`,title:`נגן את סדרת ${s.title}`,disabled:m===s.id,children:m===s.id?e.jsxs("svg",{className:"animate-spin h-6 w-6 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-7 h-7","aria-hidden":"true",children:e.jsx("path",{d:"M8 5v14l11-7z"})})})})]}),e.jsxs("div",{className:"p-4 space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:e.jsx("a",{href:`/stories?series_id=${s.id}`,className:"hover:underline focus:outline-none focus:ring-2 focus:ring-blue-500 rounded",children:s.title})}),e.jsx("p",{className:"text-sm text-gray-600 line-clamp-3",children:s.description||"—"})]})]},s.id)))}),!d&&!i&&o.length===0&&e.jsx("div",{className:"mt-4 text-gray-500",children:"אין סדרות להצגה כרגע."})]})}export{b as Component};
