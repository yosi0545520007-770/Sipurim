import{d as j,r as l,j as e,L as _,s as o}from"./index-DhAAA4kQ.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],L=j("chevron-down",E);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],O=j("chevron-up",M);function z(){const[f,N]=l.useState([]),[x,m]=l.useState(!0),[u,i]=l.useState(null),[p,b]=l.useState(null),[h,v]=l.useState(new Set),[y,r]=l.useState(!1),[d,w]=l.useState(null),[a,c]=l.useState({title:"",description:""});async function g(){try{m(!0),i(null);const{data:s,error:t}=await o.from("series").select("*, stories(id, title, series_order)").order("title",{ascending:!0});if(t)throw t;N(s||[])}catch(s){i(s.message||"שגיאה בטעינת הסדרות")}finally{m(!1)}}l.useEffect(()=>{g()},[]);const S=s=>{v(t=>{const n=new Set(t);return n.has(s)?n.delete(s):n.add(s),n})};function C(){w(null),c({title:"",description:""}),r(!0)}async function k(){if(!a.title.trim()){i("שם הסדרה הוא שדה חובה");return}try{i(null);const s={title:a.title.trim(),description:a.description.trim()||null},{error:t}=d?await o.from("series").update(s).eq("id",d):await o.from("series").insert(s);if(t)throw t;b("הסדרה נשמרה בהצלחה"),r(!1),await g()}catch(s){i(s.message||"שגיאה בשמירת הסדרה")}}return e.jsxs("section",{className:"p-6 space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"ניהול סדרות"}),e.jsx("button",{className:"bg-blue-600 text-white px-4 py-2 rounded-xl",onClick:C,children:"+ סדרה חדשה"})]}),u&&e.jsx("div",{className:"rounded-lg bg-red-50 text-red-700 p-3",children:u}),p&&e.jsx("div",{className:"rounded-lg bg-green-50 text-green-700 p-3",children:p}),x&&e.jsx("div",{children:"טוען רשימת סדרות..."}),!x&&e.jsx("div",{className:"space-y-2",children:f.map(s=>e.jsxs("div",{className:"rounded-xl border bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 cursor-pointer",onClick:()=>S(s.id),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold",children:s.title}),e.jsxs("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full",children:[s.stories.length," פרקים"]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(_,{to:`/admin/series/${s.id}`,onClick:t=>t.stopPropagation(),className:"px-3 py-1 rounded-lg border text-sm hover:bg-gray-50",children:"ערוך סדרה"}),h.has(s.id)?e.jsx(O,{className:"w-5 h-5"}):e.jsx(L,{className:"w-5 h-5"})]})]}),h.has(s.id)&&e.jsx("div",{className:"border-t px-3 pb-3",children:s.stories.length>0?e.jsx("ul",{className:"divide-y",children:s.stories.sort((t,n)=>(t.series_order||999)-(n.series_order||999)).map(t=>e.jsx("li",{className:"py-2 text-sm",children:t.title},t.id))}):e.jsx("div",{className:"py-3 text-sm text-gray-500",children:"אין פרקים בסדרה זו."})})]},s.id))}),y&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 grid place-items-center p-4",onClick:()=>r(!1),children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-lg p-6",onClick:s=>s.stopPropagation(),children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:d?"עריכת סדרה":"סדרה חדשה"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"שם הסדרה *"}),e.jsx("input",{className:"w-full mt-1 border rounded-lg p-2",value:a.title,onChange:s=>c({...a,title:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"תיאור (אופציונלי)"}),e.jsx("textarea",{className:"w-full mt-1 border rounded-lg p-2 min-h-[100px]",value:a.description,onChange:s=>c({...a,description:s.target.value})})]})]}),e.jsxs("div",{className:"flex gap-2 mt-6 justify-end",children:[e.jsx("button",{className:"bg-gray-200 px-4 py-2 rounded-lg",onClick:()=>r(!1),children:"ביטול"}),e.jsx("button",{className:"bg-blue-600 text-white px-4 py-2 rounded-lg",onClick:k,children:"שמירה"})]})]})})]})}export{z as Component};
