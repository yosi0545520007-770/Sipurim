import{r as a,j as e,l as E,H as D,h as M,i as H,k as _}from"./index-DhAAA4kQ.js";import{D as O}from"./react-datepicker-CAsIfJ14.js";import"./clsx-B-dksMZM.js";function b(r){try{if(!r)return"";const c=typeof r=="string"?new Date(r):r;return isNaN(c.getTime())?"":new D(c).renderGematriya()}catch{return""}}function P(){const[r,c]=a.useState([]),[y,h]=a.useState(!0),[m,l]=a.useState(null),[g,p]=a.useState(null),[w,n]=a.useState(!1),[d,f]=a.useState(null),[j,o]=a.useState(""),[i,x]=a.useState(null);async function u(){try{h(!0),l(null);const{data:t,error:s}=await E();if(s)throw new Error(s);c(t||[])}catch(t){l(t.message||"שגיאה בטעינת הנתונים")}finally{h(!1)}}a.useEffect(()=>{u()},[]);function v(){f(null),o(""),x(null),n(!0)}function S(t){f(t.id),o(t.honoree),x(t.event_date?new Date(t.event_date):null),n(!0)}async function C(){const t=j.trim();if(!t){l("יש למלא שם נזכר/ת");return}try{l(null);const s={honoree:t,event_date:i?i.toISOString().slice(0,10):null},{error:N}=d?await H(d,s):await _(s);if(N)throw new Error(N);p(`נשמר בהצלחה: ${t}`),n(!1),await u()}catch(s){l(s.message||"שגיאה בשמירה")}}async function k(t){if(confirm("למחוק את הרשומה?"))try{l(null);const{error:s}=await M(t);if(s)throw new Error(s);p("נמחק בהצלחה"),await u()}catch(s){l(s.message||"שגיאה במחיקה")}}return e.jsxs("section",{className:"p-6 space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"לעילוי נשמת (ניהול)"}),e.jsx("button",{className:"px-4 py-2 rounded-lg bg-blue-600 text-white",onClick:v,children:"הוספת רשומה"})]}),m&&e.jsx("div",{className:"bg-red-50 text-red-700 p-3 rounded",children:m}),g&&e.jsx("div",{className:"bg-green-50 text-green-700 p-3 rounded",children:g}),y?e.jsx("div",{className:"text-gray-500",children:"טוען…"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full border rounded-2xl overflow-hidden",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 text-right",children:"שם"}),e.jsx("th",{className:"p-3 text-right",children:"תאריך פטירה (עברי)"}),e.jsx("th",{className:"p-3 text-right",children:"פעולות"})]})}),e.jsxs("tbody",{children:[r.map(t=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-3 font-medium",children:t.honoree}),e.jsx("td",{className:"p-3",children:t.event_date?b(t.event_date):"—"}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex flex-wrap gap-2 justify-end",children:[e.jsx("button",{className:"px-3 py-1 rounded-lg border",onClick:()=>S(t),children:"עריכה"}),e.jsx("button",{className:"px-3 py-1 rounded-lg border border-red-300 text-red-600",onClick:()=>k(t.id),children:"מחיקה"})]})})]},t.id)),r.length===0&&e.jsx("tr",{children:e.jsx("td",{className:"p-3 text-gray-500",colSpan:3,children:"אין נתונים להצגה."})})]})]})}),w&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 grid place-items-center p-4",onClick:()=>n(!1),children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-lg p-6",onClick:t=>t.stopPropagation(),children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:d?"עריכת רשומה":"רשומה חדשה"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"שם נזכר/ת *"}),e.jsx("input",{className:"w-full mt-1 border rounded-lg p-2",value:j,onChange:t=>o(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"תאריך פטירה"}),e.jsx(O,{selected:i,onChange:t=>x(t),placeholderText:"בחירת תאריך...",className:"w-full mt-1 border rounded-lg p-2 text-right",calendarStartDay:0,isClearable:!0}),i&&e.jsxs("div",{className:"mt-1 text-sm text-gray-600",children:["עברי: ",b(i)]})]})]}),e.jsxs("div",{className:"flex gap-2 mt-6 justify-end",children:[e.jsx("button",{className:"bg-gray-200 px-4 py-2 rounded-lg",onClick:()=>n(!1),children:"ביטול"}),e.jsx("button",{className:"bg-blue-600 text-white px-4 py-2 rounded-lg",onClick:C,children:"שמור"})]})]})})]})}export{P as Component};
