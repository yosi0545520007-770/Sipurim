import{b,r,s as n,j as e}from"./index-B54MtHlO.js";function v(){const a=b(),[o,p]=r.useState([]),[i,c]=r.useState(null),[d,u]=r.useState(!0),[m,x]=r.useState(null),[h,f]=r.useState("");r.useEffect(()=>{(async()=>{u(!0),c(null);const{data:t,error:s}=await n.from("series").select("id,title,description,cover_url,created_at").order("created_at",{ascending:!1}).limit(50);s&&c(s.message),p(t||[]);const{data:l}=await n.from("settings").select("value").eq("key","site_logo_url").maybeSingle();f((l==null?void 0:l.value)||"/logo.png"),u(!1)})()},[]);async function y(t){x(t);try{const{data:s,error:l}=await n.from("stories").select("id, title, audio_url, series_id").eq("series_id",t).not("audio_url","is",null).order("series_order",{ascending:!0}).order("publish_at",{ascending:!0});if(l)throw l;const g=s||[];g.length>0?a.playQueue(g,0):alert("לא נמצאו פרקים עם שמע לסדרה זו.")}catch(s){c(s.message||"שגיאה בטעינת פרקי הסדרה")}finally{x(null)}}return e.jsxs("section",{className:"container mx-auto px-4 py-10",dir:"rtl",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"סיפורים בהמשכים"}),d&&e.jsx("div",{className:"text-gray-500",children:"טוען…"}),i&&e.jsx("div",{className:"rounded-lg bg-red-50 text-red-700 p-3 mb-4",children:i}),e.jsx("div",{className:"grid md:grid-cols-3 gap-6",children:o.map(t=>(a.queue.some(s=>s.id.startsWith(t.id))&&a.playing,e.jsxs("article",{className:"group relative rounded-2xl border bg-white overflow-hidden shadow-sm transition-shadow hover:shadow-md",children:[e.jsxs("div",{className:"relative w-full aspect-[16/9] overflow-hidden bg-gray-100",children:[t.cover_url||h?e.jsx("img",{src:t.cover_url||h,alt:t.title,className:`w-full h-full ${t.cover_url?"object-cover":"object-contain p-4"}`,loading:"lazy"}):e.jsx("div",{className:"w-full h-full grid place-items-center text-xs text-gray-400",children:"ללא תמונה"}),e.jsxs("div",{className:"absolute inset-0 bg-black/30 flex flex-col items-center justify-center gap-3 text-white text-sm font-medium text-center p-4",children:[e.jsx("button",{onClick:()=>y(t.id),className:"w-14 h-14 rounded-full bg-gray-800/60 text-white backdrop-blur flex items-center justify-center disabled:opacity-50 disabled:cursor-wait","aria-label":`נגן את סדרת ${t.title}`,title:`נגן את סדרת ${t.title}`,disabled:m===t.id,children:m===t.id?e.jsxs("svg",{className:"animate-spin h-6 w-6 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"w-7 h-7","aria-hidden":"true",children:e.jsx("path",{d:"M8 5v14l11-7z"})})}),e.jsx("span",{className:"px-3 py-1 rounded-full bg-black/60 text-xs sm:text-sm",children:"לחצו להאזנה לסיפור"})]})]}),e.jsxs("div",{className:"p-4 space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:e.jsx("a",{href:`/stories?series_id=${t.id}`,className:"hover:underline focus:outline-none focus:ring-2 focus:ring-blue-500 rounded",children:t.title})}),e.jsx("p",{className:"text-sm text-gray-600 line-clamp-3",children:t.description||"—"})]})]},t.id)))}),!d&&!i&&o.length===0&&e.jsx("div",{className:"mt-4 text-gray-500",children:"אין סדרות להצגה כרגע."})]})}export{v as Component};
