{"version":3,"file":"HolidayEvent.js","sources":["../../../src/HolidayEvent.ts"],"sourcesContent":["import {HDate, Locale, isoDateString} from '@hebcal/hdate';\nimport {Event, flags} from './event';\nimport {holidayDesc as hdesc} from './staticHolidays';\nimport './locale'; // Adds Hebrew and Ashkenazic translations\n\n/** Represents a built-in holiday like Pesach, Purim or Tu BiShvat */\nexport class HolidayEvent extends Event {\n  /** During Sukkot or Pesach */\n  cholHaMoedDay?: number;\n  chanukahDay?: number;\n  /**\n   * `true` if the fast day was postponed a day to avoid Shabbat.\n   * - Tish'a B'Av postponed from the 9th to the 10th\n   * - Tzom Tammuz postponed from the 17th to the 18th\n   */\n  observed?: boolean;\n\n  basename(): string {\n    return this.getDesc()\n      .replace(/ \\d{4}$/, '')\n      .replace(/ \\(CH''M\\)$/, '')\n      .replace(/ \\(observed\\)$/, '')\n      .replace(/ \\(Hoshana Raba\\)$/, '')\n      .replace(/ [IV]+$/, '')\n      .replace(/: \\d Candles?$/, '')\n      .replace(/: 8th Day$/, '')\n      .replace(/^Erev /, '');\n  }\n\n  url(): string | undefined {\n    const year = this.getDate().greg().getFullYear();\n    if (year < 100) {\n      return undefined;\n    }\n    const url =\n      'https://www.hebcal.com/holidays/' +\n      this.basename().toLowerCase().replace(/'/g, '').replace(/ /g, '-') +\n      '-' +\n      this.urlDateSuffix();\n    return this.getFlags() & flags.IL_ONLY ? url + '?i=on' : url;\n  }\n\n  urlDateSuffix(): string {\n    const year = this.getDate().greg().getFullYear();\n    return String(year);\n  }\n\n  getEmoji(): string {\n    if (this.emoji) {\n      return this.emoji;\n    } else if (this.getFlags() & flags.SPECIAL_SHABBAT) {\n      return 'ðŸ•';\n    } else {\n      return 'âœ¡ï¸';\n    }\n  }\n\n  getCategories(): string[] {\n    if (this.cholHaMoedDay) {\n      return ['holiday', 'major', 'cholhamoed'];\n    }\n    const cats = super.getCategories();\n    if (cats[0] !== 'unknown') {\n      return cats;\n    }\n    // Don't depend on flags.MINOR_HOLIDAY always being set. Look for minor holidays.\n    const desc = this.getDesc();\n    switch (desc) {\n      case hdesc.LAG_BAOMER:\n      case hdesc.LEIL_SELICHOT:\n      case hdesc.PESACH_SHENI:\n      case hdesc.EREV_PURIM:\n      case hdesc.PURIM_KATAN:\n      case hdesc.SHUSHAN_PURIM:\n      case hdesc.TU_BAV:\n      case hdesc.TU_BISHVAT:\n      case hdesc.ROSH_HASHANA_LABEHEMOT:\n        return ['holiday', 'minor'];\n    }\n\n    return ['holiday', 'major'];\n  }\n  /**\n   * Returns (translated) description of this event\n   * @param [locale] Optional locale name (defaults to active locale).\n   */\n  render(locale?: string): string {\n    const str = super.render(locale);\n    return str.replace(/'/g, 'â€™');\n  }\n  /**\n   * Returns a brief (translated) description of this event.\n   * For most events, this is the same as render(). For some events, it procudes\n   * a shorter text (e.g. without a time or added description).\n   * @param [locale] Optional locale name (defaults to active locale).\n   */\n  renderBrief(locale?: string): string {\n    const str = super.renderBrief(locale);\n    return str.replace(/'/g, 'â€™');\n  }\n  /**\n   * Makes a clone of this Event object\n   * @deprecated\n   */\n  clone(): HolidayEvent {\n    const ev = new HolidayEvent(this.date, this.desc, this.mask);\n    // overwrite all enumerable properties\n    Object.assign(ev, this);\n    return ev;\n  }\n}\n\n/**\n * Because Asara B'Tevet often occurs twice in the same Gregorian year,\n * we subclass HolidayEvent to generate the correct URL.\n */\nexport class AsaraBTevetEvent extends HolidayEvent {\n  urlDateSuffix(): string {\n    const isoDate = isoDateString(this.getDate().greg());\n    return isoDate.replace(/-/g, '');\n  }\n}\n\n/**\n * Because Chanukah sometimes starts in December and ends in January,\n * we subclass HolidayEvent to generate the correct URL.\n */\nexport class ChanukahEvent extends HolidayEvent {\n  urlDateSuffix(): string {\n    const dt = this.getDate().greg();\n    let year = dt.getFullYear();\n    if (dt.getMonth() === 0) {\n      year--;\n    }\n    return String(year);\n  }\n}\n\n/** Represents Rosh Hashana, the Jewish New Year */\nexport class RoshHashanaEvent extends HolidayEvent {\n  private readonly hyear: number;\n  /**\n   * @private\n   * @param date Hebrew date event occurs\n   * @param hyear Hebrew year\n   * @param mask optional holiday flags\n   */\n  constructor(date: HDate, hyear: number, mask: number) {\n    super(date, `Rosh Hashana ${hyear}`, mask);\n    this.hyear = hyear;\n  }\n  /**\n   * Returns (translated) description of this event\n   * @param [locale] Optional locale name (defaults to active locale).\n   */\n  render(locale?: string): string {\n    return Locale.gettext('Rosh Hashana', locale) + ' ' + this.hyear;\n  }\n\n  getEmoji(): string {\n    return 'ðŸðŸ¯';\n  }\n}\n\nconst roshChodeshStr = 'Rosh Chodesh';\n\n/** Represents Rosh Chodesh, the beginning of a new month */\nexport class RoshChodeshEvent extends HolidayEvent {\n  /**\n   * Constructs Rosh Chodesh event\n   * @param date Hebrew date event occurs\n   * @param monthName Hebrew month name (not translated)\n   */\n  constructor(date: HDate, monthName: string) {\n    super(date, `${roshChodeshStr} ${monthName}`, flags.ROSH_CHODESH);\n  }\n  /**\n   * Returns (translated) description of this event\n   * @param [locale] Optional locale name (defaults to active locale).\n   */\n  render(locale?: string): string {\n    const monthName = this.getDesc().substring(roshChodeshStr.length + 1);\n    const monthName0 = Locale.gettext(monthName, locale);\n    const monthName1 = monthName0.replace(/'/g, 'â€™');\n    return Locale.gettext(roshChodeshStr, locale) + ' ' + monthName1;\n  }\n\n  basename(): string {\n    return this.getDesc();\n  }\n\n  getEmoji(): string {\n    return this.emoji || 'ðŸŒ’';\n  }\n}\n"],"names":["hdesc"],"mappings":"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"}