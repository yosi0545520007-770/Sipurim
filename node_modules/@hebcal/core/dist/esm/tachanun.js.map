{"version":3,"file":"tachanun.js","sources":["../../../src/tachanun.ts"],"sourcesContent":["import {HDate, months} from '@hebcal/hdate';\nimport {dateYomHaZikaron} from './modern';\n\nfunction range(start: number, end: number): readonly number[] {\n  const arr = [];\n  for (let i = start; i <= end; i++) {\n    arr.push(i);\n  }\n  return arr;\n}\n\n/**\n * Is *tachanun* said today?\n */\nexport type TachanunResult = {\n  /** Tachanun is said at Shacharit */\n  shacharit: boolean;\n  /** Tachanun is said at Mincha */\n  mincha: boolean;\n  /** All congregations say Tachanun on the day */\n  allCongs: boolean;\n};\n\nconst NONE: TachanunResult = {\n  shacharit: false,\n  mincha: false,\n  allCongs: false,\n} as const;\n\n/**\n * Return details on what Tachanun (or Tzidchatcha on Shabbat) is said on `hdate`.\n *\n * Tachanun is not said on Rosh Chodesh, the month of Nisan, Lag Baomer,\n * Rosh Chodesh Sivan until Isru Chag, Tisha B'av, 15 Av, Erev Rosh Hashanah,\n * Rosh Hashanah, Erev Yom Kippur until after Simchat Torah, Chanukah,\n * Tu B'shvat, Purim and Shushan Purim, and Purim and Shushan Purim Katan.\n *\n * In some congregations Tachanun is not said until from Rosh Chodesh Sivan\n * until 14th Sivan, Sukkot until after Rosh Chodesh Cheshvan, Pesach Sheini,\n * Yom Ha'atzmaut, and Yom Yerushalayim.\n *\n * Tachanun is not said at Mincha on days before it is not said at Shacharit.\n *\n * Tachanun is not said at Shacharit on Shabbat, but is at Mincha, usually.\n */\nexport function tachanun(hdate: HDate, il: boolean): TachanunResult {\n  return tachanun0(hdate, il, true);\n}\n\nfunction tachanun0(\n  hdate: HDate,\n  il: boolean,\n  checkNext: boolean\n): TachanunResult {\n  const year = hdate.yy;\n  const dates = tachanunYear(year, il);\n  const abs = hdate.abs();\n  if (dates.none.indexOf(abs) > -1) {\n    return NONE;\n  }\n  const dow = hdate.getDay();\n  const ret: TachanunResult = {\n    shacharit: false,\n    mincha: false,\n    allCongs: false,\n  };\n  if (dates.some.indexOf(abs) === -1) {\n    ret.allCongs = true;\n  }\n  if (dow !== 6) {\n    ret.shacharit = true;\n  }\n  const tomorrow = abs + 1;\n  if (checkNext && dates.yesPrev.indexOf(tomorrow) === -1) {\n    const tmp = tachanun0(new HDate(tomorrow), il, false);\n    ret.mincha = tmp.shacharit;\n  } else {\n    ret.mincha = dow !== 5;\n  }\n  if (ret.allCongs && !ret.mincha && !ret.shacharit) {\n    return NONE;\n  }\n  return ret;\n}\n\ntype TachanunYear = {\n  none: number[];\n  some: number[];\n  yesPrev: number[];\n};\n\nfunction tachanunYear(year: number, il: boolean): TachanunYear {\n  const leap = HDate.isLeapYear(year);\n  const monthsInYear = HDate.monthsInYear(year);\n  let av9dt = new HDate(9, months.AV, year);\n  if (av9dt.getDay() === 6) {\n    av9dt = av9dt.next();\n  }\n  let shushPurim = new HDate(15, months.ADAR_II, year);\n  if (shushPurim.getDay() === 6) {\n    shushPurim = shushPurim.next();\n  }\n  const none: readonly HDate[] = [\n    new HDate(2, months.TISHREI, year), // Rosh Hashana II\n  ].concat(\n    // Rosh Chodesh - 1st of every month. Also includes RH day 1 (1 Tishrei)\n    range(1, monthsInYear).map(month => new HDate(1, month, year)),\n    // Rosh Chodesh - 30th of months that have one\n    range(1, monthsInYear)\n      .filter(month => HDate.daysInMonth(month, year) === 30)\n      .map(month => new HDate(30, month, year)),\n    // entire month of Nisan\n    range(1, HDate.daysInMonth(months.NISAN, year)).map(\n      mday => new HDate(mday, months.NISAN, year)\n    ),\n    new HDate(18, months.IYYAR, year), // Lag BaOmer\n    // Rosh Chodesh Sivan thru Isru Chag\n    range(1, 8 - (il ? 1 : 0)).map(mday => new HDate(mday, months.SIVAN, year)),\n    av9dt, // Tisha B'Av\n    new HDate(15, months.AV, year), // Tu B'Av\n    new HDate(29, months.ELUL, year), // Erev Rosh Hashanah\n    // Erev Yom Kippur thru Isru Chag\n    range(9, 24 - (il ? 1 : 0)).map(\n      mday => new HDate(mday, months.TISHREI, year)\n    ),\n    // Chanukah\n    range(25, 33).map(mday => new HDate(mday, months.KISLEV, year)),\n    new HDate(15, months.SHVAT, year), // Tu BiShvat\n    new HDate(14, months.ADAR_II, year), // Purim\n    shushPurim,\n    leap ? new HDate(14, months.ADAR_I, year) : [] // Purim Katan\n  );\n  const some: readonly HDate[] = [\n    new HDate(14, months.IYYAR, year), // Pesach Sheini\n  ].concat(\n    // Until 14 Sivan\n    range(1, 13).map(mday => new HDate(mday, months.SIVAN, year)),\n    // Until after Rosh Chodesh Cheshvan\n    range(20, 31).map(mday => new HDate(mday, months.TISHREI, year)),\n    // Yom HaAtzma'ut, which changes based on day of week\n    year >= 5708 ? (dateYomHaZikaron(year) as HDate).next() : [],\n    // Yom Yerushalayim\n    year >= 5727 ? new HDate(28, months.IYYAR, year) : []\n  );\n  const yesPrev: readonly HDate[] = [\n    new HDate(29, months.ELUL, year - 1), // Erev Rosh Hashanah\n    new HDate(9, months.TISHREI, year), // Erev Yom Kippur\n    new HDate(14, months.IYYAR, year), // Pesach Sheini\n  ];\n  return {\n    none: none.map(hd => hd.abs()).sort((a, b) => a - b),\n    some: some.map(hd => hd.abs()).sort((a, b) => a - b),\n    yesPrev: yesPrev.map(hd => hd.abs()).sort((a, b) => a - b),\n  };\n}\n"],"names":[],"mappings":"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"}