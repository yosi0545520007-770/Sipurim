{"version":3,"file":"holidays.js","sources":["../../../src/holidays.ts"],"sourcesContent":["/*\n    Hebcal - A Jewish Calendar Generator\n    Copyright (c) 1994-2020 Danny Sadinoff\n    Portions copyright Eyal Schachter and Michael J. Radwin\n\n    https://github.com/hebcal/hebcal-es6\n\n    This program is free software; you can redistribute it and/or\n    modify it under the terms of the GNU General Public License\n    as published by the Free Software Foundation; either version 2\n    of the License, or (at your option) any later version.\n\n    This program is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU General Public License for more details.\n\n    You should have received a copy of the GNU General Public License\n    along with this program. If not, see <http://www.gnu.org/licenses/>.\n */\nimport {HDate, months} from '@hebcal/hdate';\nimport QuickLRU from 'quick-lru';\nimport {Event, flags} from './event';\nimport {dateYomHaShoah, dateYomHaZikaron} from './modern';\nimport {getSedra} from './sedra';\nimport {\n  staticHolidays,\n  staticModernHolidays,\n  holidayDesc as hdesc,\n} from './staticHolidays';\nimport {YomKippurKatanEvent} from './YomKippurKatanEvent';\nimport {\n  HolidayEvent,\n  ChanukahEvent,\n  AsaraBTevetEvent,\n  RoshHashanaEvent,\n  RoshChodeshEvent,\n} from './HolidayEvent';\n\n/** @private */\nfunction observedInIsrael(ev: Event): boolean {\n  return ev.observedInIsrael();\n}\n\n/** @private */\nfunction observedInDiaspora(ev: Event): boolean {\n  return ev.observedInDiaspora();\n}\n\n/** @private */\nfunction holidayFilter(il: boolean) {\n  return il ? observedInIsrael : observedInDiaspora;\n}\n\n/**\n * Returns an array of Events on this date (or `undefined` if no events)\n * @param date Hebrew Date, Gregorian date, or absolute R.D. day number\n * @param [il] use the Israeli schedule for holidays\n */\nexport function getHolidaysOnDate(\n  date: HDate | Date | number,\n  il?: boolean\n): HolidayEvent[] | undefined {\n  const hd = HDate.isHDate(date) ? (date as HDate) : new HDate(date);\n  const hdStr = hd.toString();\n  const yearMap = getHolidaysForYear_(hd.getFullYear());\n  const events = yearMap.get(hdStr);\n  // if il isn't a boolean return both diaspora + IL for day\n  if (typeof il === 'undefined' || typeof events === 'undefined') {\n    return events;\n  }\n  const filtered = events.filter(holidayFilter(il));\n  return filtered;\n}\n\nconst CHAG = flags.CHAG;\nconst IL_ONLY = flags.IL_ONLY;\nconst LIGHT_CANDLES_TZEIS = flags.LIGHT_CANDLES_TZEIS;\nconst CHANUKAH_CANDLES = flags.CHANUKAH_CANDLES;\nconst MINOR_FAST = flags.MINOR_FAST;\nconst SPECIAL_SHABBAT = flags.SPECIAL_SHABBAT;\nconst MODERN_HOLIDAY = flags.MODERN_HOLIDAY;\nconst MAJOR_FAST = flags.MAJOR_FAST;\nconst MINOR_HOLIDAY = flags.MINOR_HOLIDAY;\nconst EREV = flags.EREV;\n\nconst SUN = 0;\nconst TUE = 2;\nconst THU = 4;\nconst FRI = 5;\nconst SAT = 6;\n\nconst NISAN = months.NISAN;\nconst TAMUZ = months.TAMUZ;\nconst AV = months.AV;\nconst TISHREI = months.TISHREI;\nconst KISLEV = months.KISLEV;\nconst TEVET = months.TEVET;\nconst ADAR_I = months.ADAR_I;\nconst ADAR_II = months.ADAR_II;\n\nconst emojiIsraelFlag = {emoji: 'üáÆüá±'} as const;\nconst chanukahEmoji = 'üïé';\nexport type HolidayYearMap = Map<string, HolidayEvent[]>;\nconst yearCache = new QuickLRU<number, HolidayYearMap>({maxSize: 400});\n\nconst KEYCAP_DIGITS = [\n  '0Ô∏è‚É£',\n  '1Ô∏è‚É£',\n  '2Ô∏è‚É£',\n  '3Ô∏è‚É£',\n  '4Ô∏è‚É£',\n  '5Ô∏è‚É£',\n  '6Ô∏è‚É£',\n  '7Ô∏è‚É£',\n  '8Ô∏è‚É£',\n  '9Ô∏è‚É£',\n] as const;\n\n/**\n * Lower-level holidays interface, which returns a `Map` of `Event`s indexed by\n * `HDate.toString()`. These events must filtered especially for `flags.IL_ONLY`\n * or `flags.CHUL_ONLY` depending on Israel vs. Diaspora holiday scheme.\n * @private\n */\nexport function getHolidaysForYear_(year: number): HolidayYearMap {\n  if (typeof year !== 'number') {\n    throw new TypeError(`bad Hebrew year: ${year}`);\n  } else if (year < 1 || year > 32658) {\n    throw new RangeError(`Hebrew year ${year} out of range 1-32658`);\n  }\n  const cached = yearCache.get(year);\n  if (cached) {\n    return cached;\n  }\n\n  const RH = new HDate(1, TISHREI, year);\n  const pesach = new HDate(15, NISAN, year);\n\n  const map = new Map<string, HolidayEvent[]>();\n  function add(...events: HolidayEvent[]) {\n    for (const ev of events) {\n      const key = ev.date.toString();\n      const arr = map.get(key);\n      if (typeof arr === 'object') {\n        if (arr[0].getFlags() & EREV) {\n          arr.unshift(ev);\n        } else {\n          arr.push(ev);\n        }\n      } else {\n        map.set(key, [ev]);\n      }\n    }\n  }\n\n  for (const h of staticHolidays) {\n    const hd = new HDate(h.dd, h.mm, year);\n    const ev = new HolidayEvent(hd, h.desc, h.flags);\n    if (h.emoji) ev.emoji = h.emoji;\n    if (h.chmDay) ev.cholHaMoedDay = h.chmDay;\n    add(ev);\n  }\n\n  // standard holidays that don't shift based on year\n  add(new RoshHashanaEvent(RH, year, CHAG | LIGHT_CANDLES_TZEIS));\n\n  // Variable date holidays\n  const tzomGedaliahDay: number = RH.getDay() === THU ? 4 : 3;\n  add(\n    new HolidayEvent(\n      new HDate(tzomGedaliahDay, TISHREI, year),\n      hdesc.TZOM_GEDALIAH,\n      MINOR_FAST\n    )\n  );\n  // first SAT after RH\n  add(\n    new HolidayEvent(\n      new HDate(HDate.dayOnOrBefore(SAT, 7 + RH.abs())),\n      hdesc.SHABBAT_SHUVA,\n      SPECIAL_SHABBAT\n    )\n  );\n  const rchTevet = HDate.shortKislev(year)\n    ? new HDate(1, TEVET, year)\n    : new HDate(30, KISLEV, year);\n  add(new HolidayEvent(rchTevet, hdesc.CHAG_HABANOT, MINOR_HOLIDAY));\n  // yes, we know Kislev 30-32 are wrong\n  // HDate() corrects the month automatically\n  for (let candles = 2; candles <= 8; candles++) {\n    const hd = new HDate(23 + candles, KISLEV, year);\n    add(\n      new ChanukahEvent(\n        hd,\n        `Chanukah: ${candles} Candles`,\n        MINOR_HOLIDAY | CHANUKAH_CANDLES,\n        {\n          chanukahDay: candles - 1,\n          emoji: chanukahEmoji + KEYCAP_DIGITS[candles],\n        }\n      )\n    );\n  }\n  add(\n    new ChanukahEvent(\n      new HDate(32, KISLEV, year),\n      hdesc.CHANUKAH_8TH_DAY,\n      MINOR_HOLIDAY,\n      {chanukahDay: 8, emoji: chanukahEmoji}\n    )\n  );\n  add(\n    new AsaraBTevetEvent(\n      new HDate(10, TEVET, year),\n      hdesc.ASARA_BTEVET,\n      MINOR_FAST\n    )\n  );\n  const pesachAbs = pesach.abs();\n  add(\n    new HolidayEvent(\n      new HDate(HDate.dayOnOrBefore(SAT, pesachAbs - 43)),\n      hdesc.SHABBAT_SHEKALIM,\n      SPECIAL_SHABBAT\n    ),\n    new HolidayEvent(\n      new HDate(HDate.dayOnOrBefore(SAT, pesachAbs - 30)),\n      hdesc.SHABBAT_ZACHOR,\n      SPECIAL_SHABBAT\n    ),\n    new HolidayEvent(\n      new HDate(pesachAbs - (pesach.getDay() === TUE ? 33 : 31)),\n      hdesc.TAANIT_ESTHER,\n      MINOR_FAST\n    )\n  );\n  const haChodeshAbs = HDate.dayOnOrBefore(SAT, pesachAbs - 14);\n  add(\n    new HolidayEvent(\n      new HDate(haChodeshAbs - 7),\n      hdesc.SHABBAT_PARAH,\n      SPECIAL_SHABBAT\n    ),\n    new HolidayEvent(\n      new HDate(haChodeshAbs),\n      hdesc.SHABBAT_HACHODESH,\n      SPECIAL_SHABBAT\n    ),\n    new HolidayEvent(\n      new HDate(HDate.dayOnOrBefore(SAT, pesachAbs - 1)),\n      hdesc.SHABBAT_HAGADOL,\n      SPECIAL_SHABBAT\n    ),\n    new HolidayEvent(\n      // if the fast falls on Shabbat, move to Thursday\n      pesach.prev().getDay() === SAT\n        ? pesach.onOrBefore(THU)\n        : new HDate(14, NISAN, year),\n      hdesc.TAANIT_BECHOROT,\n      MINOR_FAST\n    )\n  );\n  add(\n    new HolidayEvent(\n      new HDate(\n        HDate.dayOnOrBefore(SAT, new HDate(1, TISHREI, year + 1).abs() - 4)\n      ),\n      hdesc.LEIL_SELICHOT,\n      MINOR_HOLIDAY,\n      {emoji: 'üïç'}\n    )\n  );\n\n  if (pesach.getDay() === SUN) {\n    add(\n      new HolidayEvent(\n        new HDate(16, ADAR_II, year),\n        hdesc.PURIM_MESHULASH,\n        MINOR_HOLIDAY\n      )\n    );\n  }\n\n  if (HDate.isLeapYear(year)) {\n    add(\n      new HolidayEvent(\n        new HDate(14, ADAR_I, year),\n        hdesc.PURIM_KATAN,\n        MINOR_HOLIDAY,\n        {emoji: 'üé≠Ô∏è'}\n      )\n    );\n    add(\n      new HolidayEvent(\n        new HDate(15, ADAR_I, year),\n        hdesc.SHUSHAN_PURIM_KATAN,\n        MINOR_HOLIDAY,\n        {emoji: 'üé≠Ô∏è'}\n      )\n    );\n  }\n\n  const nisan27dt = dateYomHaShoah(year);\n  if (nisan27dt) {\n    add(new HolidayEvent(nisan27dt, hdesc.YOM_HASHOAH, MODERN_HOLIDAY));\n  }\n\n  const yomHaZikaronDt = dateYomHaZikaron(year);\n  if (yomHaZikaronDt) {\n    add(\n      new HolidayEvent(\n        yomHaZikaronDt,\n        hdesc.YOM_HAZIKARON,\n        MODERN_HOLIDAY,\n        emojiIsraelFlag\n      ),\n      new HolidayEvent(\n        yomHaZikaronDt.next(),\n        hdesc.YOM_HAATZMA_UT,\n        MODERN_HOLIDAY,\n        emojiIsraelFlag\n      )\n    );\n  }\n\n  for (const h of staticModernHolidays) {\n    if (year >= h.firstYear) {\n      let hd = new HDate(h.dd, h.mm, year);\n      const dow = hd.getDay();\n      if (h.friSatMovetoThu && (dow === FRI || dow === SAT)) {\n        hd = hd.onOrBefore(THU);\n      } else if (h.friPostponeToSun && dow === FRI) {\n        hd = new HDate(hd.abs() + 2);\n      } else if (h.satPostponeToSun && dow === SAT) {\n        hd = hd.next();\n      }\n      const mask = h.chul ? MODERN_HOLIDAY : MODERN_HOLIDAY | IL_ONLY;\n      const ev = new HolidayEvent(hd, h.desc, mask);\n      if (!h.suppressEmoji) {\n        ev.emoji = 'üáÆüá±';\n      }\n      add(ev);\n    }\n  }\n\n  let tamuz17 = new HDate(17, TAMUZ, year);\n  let tamuz17attrs;\n  if (tamuz17.getDay() === SAT) {\n    tamuz17 = new HDate(18, TAMUZ, year);\n    tamuz17attrs = {observed: true};\n  }\n  add(new HolidayEvent(tamuz17, hdesc.TZOM_TAMMUZ, MINOR_FAST, tamuz17attrs));\n\n  let av9dt = new HDate(9, AV, year);\n  let av9title = hdesc.TISHA_BAV;\n  let av9attrs;\n  if (av9dt.getDay() === SAT) {\n    av9dt = av9dt.next();\n    av9attrs = {observed: true};\n    av9title += ' (observed)';\n  }\n  const av9abs = av9dt.abs();\n  add(\n    new HolidayEvent(\n      new HDate(HDate.dayOnOrBefore(SAT, av9abs)),\n      hdesc.SHABBAT_CHAZON,\n      SPECIAL_SHABBAT\n    ),\n    new HolidayEvent(\n      av9dt.prev(),\n      hdesc.EREV_TISHA_BAV,\n      EREV | MAJOR_FAST,\n      av9attrs\n    ),\n    new HolidayEvent(av9dt, av9title, MAJOR_FAST, av9attrs),\n    new HolidayEvent(\n      new HDate(HDate.dayOnOrBefore(SAT, av9abs + 7)),\n      hdesc.SHABBAT_NACHAMU,\n      SPECIAL_SHABBAT\n    )\n  );\n\n  const monthsInYear = HDate.monthsInYear(year);\n  for (let month = 1; month <= monthsInYear; month++) {\n    const monthName = HDate.getMonthName(month, year);\n    if (\n      (month === NISAN\n        ? HDate.daysInMonth(HDate.monthsInYear(year - 1), year - 1)\n        : HDate.daysInMonth(month - 1, year)) === 30\n    ) {\n      add(new RoshChodeshEvent(new HDate(1, month, year), monthName));\n      add(new RoshChodeshEvent(new HDate(30, month - 1, year), monthName));\n    } else if (month !== TISHREI) {\n      add(new RoshChodeshEvent(new HDate(1, month, year), monthName));\n    }\n  }\n\n  // Begin: Yom Kippur Katan\n  // start at Iyyar because one may not fast during Nisan\n  for (let month = months.IYYAR; month <= monthsInYear; month++) {\n    const nextMonth = month + 1;\n    // Yom Kippur Katan is not observed on the day before Rosh Hashanah.\n    // Not observed prior to Rosh Chodesh Cheshvan because Yom Kippur has just passed.\n    // Not observed before Rosh Chodesh Tevet, because that day is Hanukkah.\n    if (\n      nextMonth === TISHREI ||\n      nextMonth === months.CHESHVAN ||\n      nextMonth === TEVET\n    ) {\n      continue;\n    }\n    let ykk = new HDate(29, month, year);\n    const dow = ykk.getDay();\n    if (dow === FRI || dow === SAT) {\n      ykk = ykk.onOrBefore(THU);\n    }\n\n    const nextMonthName = HDate.getMonthName(nextMonth, year);\n    const ev = new YomKippurKatanEvent(ykk, nextMonthName);\n    add(ev);\n  }\n\n  const sedra = getSedra(year, false);\n  const beshalachHd = sedra.find(15) as HDate;\n  add(new HolidayEvent(beshalachHd, hdesc.SHABBAT_SHIRAH, SPECIAL_SHABBAT));\n\n  // Birkat Hachamah appears only once every 28 years\n  const birkatHaChama = getBirkatHaChama(year);\n  if (birkatHaChama) {\n    const hd = new HDate(birkatHaChama);\n    add(\n      new HolidayEvent(hd, hdesc.BIRKAT_HACHAMAH, MINOR_HOLIDAY, {emoji: '‚òÄÔ∏è'})\n    );\n  }\n\n  yearCache.set(year, map);\n  return map;\n}\n\n/**\n * Birkat Hachamah appears only once every 28 years.\n * Although almost always in Nisan, it can occur in Adar II.\n *   - 27 Adar II 5461 (Gregorian year 1701)\n *   - 29 Adar II 5993 (Gregorian year 2233)\n *\n * Due to drift, this will eventually slip into Iyyar\n *   - 2 Iyyar 7141 (Gregorian year 3381)\n * @private\n */\nfunction getBirkatHaChama(year: number): number {\n  const leap = HDate.isLeapYear(year);\n  const startMonth = leap ? ADAR_II : NISAN;\n  const startDay = leap ? 20 : 1;\n  const baseRd = HDate.hebrew2abs(year, startMonth, startDay);\n  for (let day = 0; day <= 40; day++) {\n    const abs = baseRd + day;\n    const elapsed = abs + 1373429;\n    if (elapsed % 10227 === 172) {\n      return abs;\n    }\n  }\n  return 0;\n}\n\n/**\n * Returns an array of holidays for the year\n * @param year Hebrew year\n * @param il use the Israeli schedule for holidays\n */\nexport function getHolidaysForYearArray(\n  year: number,\n  il: boolean\n): HolidayEvent[] {\n  const yearMap = getHolidaysForYear_(year);\n  const startAbs = HDate.hebrew2abs(year, TISHREI, 1);\n  const endAbs = HDate.hebrew2abs(year + 1, TISHREI, 1) - 1;\n  let events: HolidayEvent[] = [];\n  const myFilter = il ? observedInIsrael : observedInDiaspora;\n  for (let absDt = startAbs; absDt <= endAbs; absDt++) {\n    const hd = new HDate(absDt);\n    const holidays = yearMap.get(hd.toString());\n    if (holidays) {\n      const filtered: HolidayEvent[] = holidays.filter(myFilter);\n      events = events.concat(filtered);\n    }\n  }\n  return events;\n}\n"],"names":["hdesc"],"mappings":"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"}